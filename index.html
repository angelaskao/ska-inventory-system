<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKA Enterprise Inventory Management System - SharePoint Connected</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        
        .enterprise-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: #1e293b;
            color: white;
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
        }
        
        .main-content {
            margin-left: 280px;
            padding: 20px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 900px;
            width: 95%;
            max-height: 95vh;
            overflow-y: auto;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #0078d4;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .integration-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .config-panel {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SharePoint Configuration
        const SHAREPOINT_CONFIG = {
            siteUrl: '', // Will be set by user
            listNames: {
                inventory: 'SKA_Inventory_Master',
                locations: 'SKA_Locations', 
                transfers: 'SKA_Transfers2',
                workOrders: 'SKA_Work_Orders1'
            }
        };

        // Icons
        const DashboardIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 5v14l11-7z" />
            </svg>
        );

        const InventoryIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
        );

        const TransferIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
            </svg>
        );

        const ReportsIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        );

        const SettingsIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const QrCodeIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
            </svg>
        );

        const PlusIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
        );

        const SharePointIcon = () => (
            <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12.5 2C10.6 2 9 3.6 9 5.5s1.6 3.5 3.5 3.5c.7 0 1.4-.2 1.9-.6L17 11c0 .6-.1 1.1-.3 1.6l-2.6-1.5c-.4.4-.9.6-1.6.6-1.9 0-3.5-1.6-3.5-3.5 0-.3.1-.7.2-1L6.6 6.6C6.1 6.9 5.3 7 4.5 7 2.6 7 1 5.4 1 3.5S2.6 0 4.5 0s3.5 1.6 3.5 3.5c0 .3-.1.7-.2 1l2.6.6c.5-.3 1.3-.4 2.1-.4z" />
            </svg>
        );

        const LimbleIcon = () => (
            <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm0-14c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6z" />
            </svg>
        );

        // SharePoint Service Class
        class SharePointService {
            constructor(siteUrl) {
                this.siteUrl = siteUrl;
                this.headers = {
                    'Accept': 'application/json;odata=verbose',
                    'Content-Type': 'application/json;odata=verbose'
                };
            }

            setSiteUrl(url) {
                this.siteUrl = url;
            }

            async getFormDigest() {
                try {
                    const response = await fetch(`${this.siteUrl}/_api/contextinfo`, {
                        method: 'POST',
                        headers: this.headers,
                        credentials: 'same-origin'
                    });
                    const data = await response.json();
                    return data.d.GetContextWebInformation.FormDigestValue;
                } catch (error) {
                    console.error('Error getting form digest:', error);
                    throw error;
                }
            }

            async getInventoryItems() {
                try {
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.inventory}')/items?$top=5000`,
                        {
                            headers: this.headers,
                            credentials: 'same-origin'
                        }
                    );
                    const data = await response.json();
                    return data.d.results.map(item => ({
                        id: item.Id,
                        name: item.Title,
                        partNumber: item.Part_x0020_Number,
                        serialNumber: item.Serial_x0020_Number || '',
                        batchNumber: item.Batch_x0020_Number || '',
                        location: item.Location,
                        binLocation: item.Bin_x0020_Location || '',
                        quantity: item.Current_x0020_Quantity || 0,
                        minQuantity: item.Minimum_x0020_Quantity || 0,
                        category: item.Category || '',
                        vendor: item.Vendor || '',
                        unitCost: item.Unit_x0020_Cost || 0,
                        criticality: item.Criticality || 'Medium',
                        lastUpdated: new Date().toISOString().split('T')[0],
                        status: (item.Current_x0020_Quantity || 0) <= (item.Minimum_x0020_Quantity || 0) ? 'Low Stock' : 'In Stock'
                    }));
                } catch (error) {
                    console.error('Error fetching inventory:', error);
                    throw error;
                }
            }

            async getLocations() {
                try {
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.locations}')/items`,
                        {
                            headers: this.headers,
                            credentials: 'same-origin'
                        }
                    );
                    const data = await response.json();
                    return data.d.results.map(item => ({
                        id: item.Location_x0020_ID2 || item.Id.toString(),
                        name: item.Title,
                        type: item.Location_x0020_Type || 'Warehouse',
                        address: item.Physical_x0020_Address || '',
                        capacity: item.Storage_x0020_Capacity || 0,
                        active: item.Active_x0020_Status === '1',
                        contactEmail: item.Contact_x0020_Email || '',
                        contactPhone: item.Contact_x0020_Phone || '',
                        utilization: item.Current_x0020_Utilization || 0
                    }));
                } catch (error) {
                    console.error('Error fetching locations:', error);
                    throw error;
                }
            }

            async getTransfers() {
                try {
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.transfers}')/items`,
                        {
                            headers: this.headers,
                            credentials: 'same-origin'
                        }
                    );
                    const data = await response.json();
                    return data.d.results.map(item => ({
                        id: item.Id,
                        itemName: item.Item_x0020_Name || item.field_1,
                        fromLocation: item.From_x0020_Location || item.field_2,
                        toLocation: item.To_x0020_Location || item.field_3,
                        quantity: item.Transfer_x0020_Quantity || item.field_4 || 0,
                        status: item.Status || item.field_7 || 'Pending',
                        createdDate: item.Requested_x0020_Date || new Date().toISOString().split('T')[0],
                        priority: item.Priority || item.field_6 || 'Normal',
                        notes: item.Transfer_x0020_Notes || item.field_14 || ''
                    }));
                } catch (error) {
                    console.error('Error fetching transfers:', error);
                    throw error;
                }
            }

            async addInventoryItem(item) {
                try {
                    const digest = await this.getFormDigest();
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.inventory}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                ...this.headers,
                                'X-RequestDigest': digest
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.SKA_x005f_Inventory_x005f_MasterListItem' },
                                Title: item.name,
                                Part_x0020_Number: item.partNumber,
                                Serial_x0020_Number: item.serialNumber || '',
                                Batch_x0020_Number: item.batchNumber || '',
                                Location: item.location,
                                Bin_x0020_Location: item.binLocation || '',
                                Current_x0020_Quantity: item.quantity,
                                Minimum_x0020_Quantity: item.minQuantity,
                                Category: item.category,
                                Vendor: item.vendor || '',
                                Unit_x0020_Cost: item.unitCost || 0,
                                Criticality: item.criticality || 'Medium'
                            })
                        }
                    );
                    return await response.json();
                } catch (error) {
                    console.error('Error adding inventory item:', error);
                    throw error;
                }
            }

            async updateInventoryItem(itemId, updates) {
                try {
                    const digest = await this.getFormDigest();
                    const updateData = {};
                    
                    // Map updates to SharePoint field names
                    if (updates.quantity !== undefined) updateData.Current_x0020_Quantity = updates.quantity;
                    if (updates.location !== undefined) updateData.Location = updates.location;
                    if (updates.binLocation !== undefined) updateData.Bin_x0020_Location = updates.binLocation;
                    if (updates.minQuantity !== undefined) updateData.Minimum_x0020_Quantity = updates.minQuantity;
                    
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.inventory}')/items(${itemId})`,
                        {
                            method: 'MERGE',
                            headers: {
                                ...this.headers,
                                'X-RequestDigest': digest,
                                'IF-MATCH': '*'
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.SKA_x005f_Inventory_x005f_MasterListItem' },
                                ...updateData
                            })
                        }
                    );
                    return response.ok;
                } catch (error) {
                    console.error('Error updating inventory item:', error);
                    throw error;
                }
            }

            async createTransfer(transfer) {
                try {
                    const digest = await this.getFormDigest();
                    const response = await fetch(
                        `${this.siteUrl}/_api/web/lists/getbytitle('${SHAREPOINT_CONFIG.listNames.transfers}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                ...this.headers,
                                'X-RequestDigest': digest
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.SKA_x005f_Transfers2ListItem' },
                                Title: `TXN-${Date.now()}`,
                                field_1: transfer.itemName,
                                field_2: transfer.fromLocation,
                                field_3: transfer.toLocation,
                                field_4: transfer.quantity,
                                field_5: transfer.transferType || 'Standard',
                                field_6: transfer.priority || 'Normal',
                                field_7: 'Pending',
                                field_8: transfer.requestedBy || 'Current User',
                                field_9: new Date().toISOString(),
                                field_11: transfer.justification || '',
                                field_14: transfer.notes || ''
                            })
                        }
                    );
                    return await response.json();
                } catch (error) {
                    console.error('Error creating transfer:', error);
                    throw error;
                }
            }
        }

        // Configuration Component
        const ConfigurationPanel = ({ isConfigured, onConfigure }) => {
            const [siteUrl, setSiteUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleConfigure = async () => {
                if (!siteUrl) {
                    alert('Please enter your SharePoint site URL');
                    return;
                }

                setIsLoading(true);
                // Validate URL format
                if (!siteUrl.includes('sharepoint.com')) {
                    alert('Please enter a valid SharePoint site URL');
                    setIsLoading(false);
                    return;
                }

                onConfigure(siteUrl);
                setIsLoading(false);
            };

            if (isConfigured) return null;

            return (
                <div className="config-panel">
                    <h2 className="text-2xl font-bold mb-4">🔧 SharePoint Configuration</h2>
                    <p className="text-gray-600 mb-4">
                        To connect to your SharePoint site, please enter your site URL below:
                    </p>
                    <div className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                SharePoint Site URL
                            </label>
                            <input
                                type="url"
                                value={siteUrl}
                                onChange={(e) => setSiteUrl(e.target.value)}
                                placeholder="https://yourcompany.sharepoint.com/sites/ska-inventory"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                            <p className="text-xs text-gray-500 mt-1">
                                Example: https://angelaskao.sharepoint.com/sites/ska-inventory
                            </p>
                        </div>
                        <button
                            onClick={handleConfigure}
                            disabled={isLoading}
                            className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                        >
                            {isLoading && <div className="loading-spinner" />}
                            Connect to SharePoint
                        </button>
                    </div>
                    <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h3 className="font-medium text-yellow-800 mb-2">⚠️ Important Notes:</h3>
                        <ul className="text-sm text-yellow-700 space-y-1">
                            <li>• Ensure you have proper permissions to access the SharePoint lists</li>
                            <li>• The lists should already be created with the correct names</li>
                            <li>• You may need to allow pop-ups for SharePoint authentication</li>
                        </ul>
                    </div>
                </div>
            );
        };

        // Sidebar Component
        const Sidebar = ({ activeTab, setActiveTab, isOpen, setIsOpen }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: <DashboardIcon /> },
                { id: 'inventory', label: 'Inventory Management', icon: <InventoryIcon /> },
                { id: 'transfers', label: 'Transfers & Bins', icon: <TransferIcon /> },
                { id: 'reports', label: 'Analytics & Reports', icon: <ReportsIcon /> },
                { id: 'integrations', label: 'Integrations', icon: <SettingsIcon /> }
            ];

            return (
                <div className={`sidebar ${isOpen ? 'open' : ''}`}>
                    <div className="mb-8">
                        <h1 className="text-xl font-bold">SKA Enterprise</h1>
                        <p className="text-sm text-gray-300">Inventory Management</p>
                    </div>
                    
                    <nav className="space-y-2">
                        {menuItems.map(item => (
                            <button
                                key={item.id}
                                onClick={() => {
                                    setActiveTab(item.id);
                                    setIsOpen(false);
                                }}
                                className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                                    activeTab === item.id 
                                        ? 'bg-blue-600 text-white' 
                                        : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                                }`}
                            >
                                {item.icon}
                                <span>{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    <div className="mt-8 pt-8 border-t border-gray-600">
                        <div className="text-xs text-gray-400 mb-2">INTEGRATIONS</div>
                        <div className="space-y-2">
                            <div className="flex items-center space-x-2 text-green-400">
                                <SharePointIcon />
                                <span className="text-sm">SharePoint Connected</span>
                            </div>
                            <div className="flex items-center space-x-2 text-green-400">
                                <LimbleIcon />
                                <span className="text-sm">Limble CMMS Linked</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Integration Panel Component
        const IntegrationPanel = ({ connectionStatus }) => (
            <div className="integration-panel">
                <h2 className="text-2xl font-bold mb-4">🔗 Enterprise Integrations</h2>
                <div className="grid md:grid-cols-2 gap-6">
                    <div className="bg-white bg-opacity-10 rounded-lg p-4">
                        <div className="flex items-center space-x-3 mb-3">
                            <SharePointIcon />
                            <h3 className="font-bold">SharePoint Integration</h3>
                            {connectionStatus && (
                                <span className="status-badge bg-green-100 text-green-800">
                                    Connected
                                </span>
                            )}
                        </div>
                        <ul className="text-sm space-y-1 opacity-90">
                            <li>• Real-time data sync with SharePoint Lists</li>
                            <li>• Document management & workflows</li>
                            <li>• User permissions & authentication</li>
                            <li>• Custom forms & approval processes</li>
                        </ul>
                    </div>
                    <div className="bg-white bg-opacity-10 rounded-lg p-4">
                        <div className="flex items-center space-x-3 mb-3">
                            <LimbleIcon />
                            <h3 className="font-bold">Limble CMMS Integration</h3>
                        </div>
                        <ul className="text-sm space-y-1 opacity-90">
                            <li>• Automated work order creation</li>
                            <li>• Preventive maintenance scheduling</li>
                            <li>• Asset lifecycle management</li>
                            <li>• Spare parts optimization</li>
                        </ul>
                    </div>
                </div>
            </div>
        );

        // Dashboard Tab
        const DashboardTab = ({ inventoryData, locations, transfers, isLoading }) => {
            const totalValue = inventoryData.reduce((sum, item) => sum + (item.quantity * item.unitCost), 0);
            const lowStockItems = inventoryData.filter(item => item.quantity <= item.minQuantity);
            const criticalItems = inventoryData.filter(item => item.criticality === 'High');
            
            return (
                <div className="space-y-6">
                    <IntegrationPanel connectionStatus={!isLoading} />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="dashboard-card">
                            <h3 className="text-sm font-medium text-gray-600">Total Inventory Value</h3>
                            <p className="text-3xl font-bold text-blue-600">
                                {isLoading ? <div className="loading-spinner" /> : `$${totalValue.toLocaleString()}`}
                            </p>
                            <p className="text-sm text-green-600 mt-1">↗ Live SharePoint data</p>
                        </div>
                        
                        <div className="dashboard-card border-l-orange-500">
                            <h3 className="text-sm font-medium text-gray-600">Active Locations</h3>
                            <p className="text-3xl font-bold text-orange-600">
                                {isLoading ? <div className="loading-spinner" /> : locations.length}
                            </p>
                            <p className="text-sm text-gray-500 mt-1">Synchronized locations</p>
                        </div>
                        
                        <div className="dashboard-card border-l-red-500">
                            <h3 className="text-sm font-medium text-gray-600">Low Stock Alerts</h3>
                            <p className="text-3xl font-bold text-red-600">
                                {isLoading ? <div className="loading-spinner" /> : lowStockItems.length}
                            </p>
                            <p className="text-sm text-red-600 mt-1">Requires immediate attention</p>
                        </div>
                        
                        <div className="dashboard-card border-l-purple-500">
                            <h3 className="text-sm font-medium text-gray-600">Pending Transfers</h3>
                            <p className="text-3xl font-bold text-purple-600">
                                {isLoading ? <div className="loading-spinner" /> : transfers.filter(t => t.status === 'Pending').length}
                            </p>
                            <p className="text-sm text-gray-500 mt-1">Awaiting approval</p>
                        </div>
                    </div>

                    {!isLoading && inventoryData.length > 0 && (
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="dashboard-card">
                                <h3 className="text-lg font-bold mb-4">🚨 Critical Items Requiring Action</h3>
                                <div className="space-y-3">
                                    {criticalItems.slice(0, 5).map(item => (
                                        <div key={item.id} className="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                            <div>
                                                <div className="font-medium">{item.name}</div>
                                                <div className="text-sm text-gray-600">{item.partNumber}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="font-bold text-red-600">{item.quantity} units</div>
                                                <div className="text-xs text-red-500">Min: {item.minQuantity}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="dashboard-card">
                                <h3 className="text-lg font-bold mb-4">📊 SharePoint Connection Status</h3>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <span>Data Sync Status</span>
                                        <span className="status-badge bg-green-100 text-green-800">Live</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span>Total Items Synced</span>
                                        <span className="font-bold text-blue-600">{inventoryData.length}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span>Locations Connected</span>
                                        <span className="font-bold text-green-600">{locations.length}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span>Last Refresh</span>
                                        <span className="text-sm text-gray-600">Just now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Add/Edit Item Modal Component
        const ItemModal = ({ isOpen, onClose, onSave, item, locations }) => {
            const [formData, setFormData] = useState({
                name: '',
                partNumber: '',
                serialNumber: '',
                batchNumber: '',
                location: '',
                binLocation: '',
                quantity: 0,
                minQuantity: 0,
                category: 'Electronics',
                vendor: '',
                unitCost: 0,
                criticality: 'Medium'
            });

            useEffect(() => {
                if (item) {
                    setFormData(item);
                }
            }, [item]);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            if (!isOpen) return null;

            return (
                <div className="modal">
                    <div className="modal-content">
                        <h2 className="text-2xl font-bold mb-4">
                            {item ? 'Edit Inventory Item' : 'Add New Inventory Item'}
                        </h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Item Name *
                                    </label>
                                    <input
                                        type="text"
                                        required
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Part Number *
                                    </label>
                                    <input
                                        type="text"
                                        required
                                        value={formData.partNumber}
                                        onChange={(e) => setFormData({...formData, partNumber: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Serial Number
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.serialNumber}
                                        onChange={(e) => setFormData({...formData, serialNumber: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Batch Number
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.batchNumber}
                                        onChange={(e) => setFormData({...formData, batchNumber: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Location *
                                    </label>
                                    <select
                                        required
                                        value={formData.location}
                                        onChange={(e) => setFormData({...formData, location: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="">Select Location</option>
                                        {locations.map(loc => (
                                            <option key={loc.id} value={loc.name}>{loc.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Bin Location
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.binLocation}
                                        onChange={(e) => setFormData({...formData, binLocation: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Current Quantity *
                                    </label>
                                    <input
                                        type="number"
                                        required
                                        min="0"
                                        value={formData.quantity}
                                        onChange={(e) => setFormData({...formData, quantity: parseInt(e.target.value) || 0})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Minimum Quantity *
                                    </label>
                                    <input
                                        type="number"
                                        required
                                        min="0"
                                        value={formData.minQuantity}
                                        onChange={(e) => setFormData({...formData, minQuantity: parseInt(e.target.value) || 0})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Category *
                                    </label>
                                    <select
                                        required
                                        value={formData.category}
                                        onChange={(e) => setFormData({...formData, category: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="Telescope Hardware">Telescope Hardware</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Power Systems">Power Systems</option>
                                        <option value="Cables & Connectivity">Cables & Connectivity</option>
                                        <option value="Consumables">Consumables</option>
                                        <option value="Tools">Tools</option>
                                        <option value="Test Equipment">Test Equipment</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Vendor
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.vendor}
                                        onChange={(e) => setFormData({...formData, vendor: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Unit Cost ($)
                                    </label>
                                    <input
                                        type="number"
                                        min="0"
                                        step="0.01"
                                        value={formData.unitCost}
                                        onChange={(e) => setFormData({...formData, unitCost: parseFloat(e.target.value) || 0})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Criticality
                                    </label>
                                    <select
                                        value={formData.criticality}
                                        onChange={(e) => setFormData({...formData, criticality: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </div>
                            </div>
                            <div className="flex justify-end gap-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                >
                                    {item ? 'Update' : 'Add'} Item
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Transfer Modal Component
        const TransferModal = ({ isOpen, onClose, onSave, inventoryData, locations }) => {
            const [formData, setFormData] = useState({
                itemName: '',
                fromLocation: '',
                toLocation: '',
                quantity: 0,
                priority: 'Normal',
                justification: '',
                notes: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            if (!isOpen) return null;

            return (
                <div className="modal">
                    <div className="modal-content">
                        <h2 className="text-2xl font-bold mb-4">Create Transfer Request</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Select Item *
                                </label>
                                <select
                                    required
                                    value={formData.itemName}
                                    onChange={(e) => setFormData({...formData, itemName: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="">Select an item</option>
                                    {inventoryData.map(item => (
                                        <option key={item.id} value={item.name}>
                                            {item.name} ({item.partNumber}) - Available: {item.quantity}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        From Location *
                                    </label>
                                    <select
                                        required
                                        value={formData.fromLocation}
                                        onChange={(e) => setFormData({...formData, fromLocation: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="">Select source</option>
                                        {locations.map(loc => (
                                            <option key={loc.id} value={loc.name}>{loc.name}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        To Location *
                                    </label>
                                    <select
                                        required
                                        value={formData.toLocation}
                                        onChange={(e) => setFormData({...formData, toLocation: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="">Select destination</option>
                                        {locations.filter(loc => loc.name !== formData.fromLocation).map(loc => (
                                            <option key={loc.id} value={loc.name}>{loc.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <div className="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Quantity *
                                    </label>
                                    <input
                                        type="number"
                                        required
                                        min="1"
                                        value={formData.quantity}
                                        onChange={(e) => setFormData({...formData, quantity: parseInt(e.target.value) || 0})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Priority
                                    </label>
                                    <select
                                        value={formData.priority}
                                        onChange={(e) => setFormData({...formData, priority: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="Low">Low</option>
                                        <option value="Normal">Normal</option>
                                        <option value="High">High</option>
                                        <option value="Urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Business Justification
                                </label>
                                <textarea
                                    value={formData.justification}
                                    onChange={(e) => setFormData({...formData, justification: e.target.value})}
                                    rows="3"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Additional Notes
                                </label>
                                <textarea
                                    value={formData.notes}
                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                    rows="2"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div className="flex justify-end gap-3 pt-4">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                >
                                    Create Transfer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Inventory Management Tab
        const InventoryTab = ({ inventoryData, setInventoryData, locations, spService, isLoading, refreshData }) => {
            const [showAddModal, setShowAddModal] = useState(false);
            const [showScanModal, setShowScanModal] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedLocation, setSelectedLocation] = useState('all');
            const [editingItem, setEditingItem] = useState(null);
            const [isSaving, setIsSaving] = useState(false);

            const filteredInventory = inventoryData.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                     item.partNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                     item.serialNumber?.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesLocation = selectedLocation === 'all' || item.location === selectedLocation;
                return matchesSearch && matchesLocation;
            });

            const handleSaveItem = async (itemData) => {
                setIsSaving(true);
                try {
                    if (editingItem) {
                        // Update existing item
                        await spService.updateInventoryItem(editingItem.id, itemData);
                        alert('✅ Item updated successfully!');
                    } else {
                        // Add new item
                        await spService.addInventoryItem(itemData);
                        alert('✅ Item added successfully!');
                    }
                    await refreshData();
                    setShowAddModal(false);
                    setEditingItem(null);
                } catch (error) {
                    alert('❌ Error saving item: ' + error.message);
                }
                setIsSaving(false);
            };

            const handleEditItem = (item) => {
                setEditingItem(item);
                setShowAddModal(true);
            };

            return (
                <div className="space-y-6">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold">📦 Inventory Management</h2>
                            <p className="text-gray-600">SharePoint-connected inventory control</p>
                        </div>
                        <div className="flex gap-3 mt-4 md:mt-0">
                            <button
                                onClick={refreshData}
                                className="px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 flex items-center gap-2"
                            >
                                {isLoading ? <div className="loading-spinner" /> : '🔄'} Refresh
                            </button>
                            <button
                                onClick={() => {
                                    setEditingItem(null);
                                    setShowAddModal(true);
                                }}
                                className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center gap-2"
                            >
                                <PlusIcon />
                                Add New Item
                            </button>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-4 gap-4 mb-6">
                        <div className="md:col-span-3">
                            <input
                                type="text"
                                placeholder="Search by SKU, serial number, or item name..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                        <div>
                            <select
                                value={selectedLocation}
                                onChange={(e) => setSelectedLocation(e.target.value)}
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="all">All Locations</option>
                                {locations.map(location => (
                                    <option key={location.id} value={location.name}>{location.name}</option>
                                ))}
                            </select>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div className="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h3 className="text-lg font-semibold">SharePoint Inventory Data</h3>
                            <p className="text-sm text-gray-600">Live data from SharePoint lists</p>
                        </div>
                        
                        <div className="overflow-x-auto">
                            {isLoading ? (
                                <div className="text-center py-8">
                                    <div className="loading-spinner mx-auto mb-4" style={{width: '40px', height: '40px'}} />
                                    <p>Loading inventory data from SharePoint...</p>
                                </div>
                            ) : (
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product Details</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Traceability</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location & Bin</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stock Levels</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Value & Status</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {filteredInventory.map((item) => {
                                            const isLowStock = item.quantity <= item.minQuantity;
                                            const itemValue = item.quantity * item.unitCost;
                                            
                                            return (
                                                <tr key={item.id} className="hover:bg-gray-50">
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <div className="font-semibold text-gray-900">{item.name}</div>
                                                            <div className="text-sm text-gray-600">SKU: {item.partNumber}</div>
                                                            <div className="text-xs text-gray-400">{item.category}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="text-sm">
                                                            <div>Serial: {item.serialNumber || 'N/A'}</div>
                                                            <div>Batch: {item.batchNumber || 'N/A'}</div>
                                                            <div className="text-xs text-gray-500">Last tracked: {item.lastUpdated}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <div className="font-medium">{item.location}</div>
                                                            <div className="text-sm text-gray-600">Bin: {item.binLocation || 'Unassigned'}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <div className="font-bold">{item.quantity} units</div>
                                                            <div className="text-sm text-gray-600">Min: {item.minQuantity}</div>
                                                            <div className="text-sm text-gray-600">Optimal: {Math.ceil(item.minQuantity * 2.5)}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div>
                                                            <div className="font-semibold">${itemValue.toLocaleString()}</div>
                                                            <div className="text-xs text-gray-500">${item.unitCost}/unit</div>
                                                            {isLowStock ? (
                                                                <span className="status-badge bg-red-100 text-red-800 mt-1">Low Stock</span>
                                                            ) : (
                                                                <span className="status-badge bg-green-100 text-green-800 mt-1">In Stock</span>
                                                            )}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <div className="flex gap-2">
                                                            <button 
                                                                onClick={() => handleEditItem(item)}
                                                                className="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200"
                                                            >
                                                                Edit
                                                            </button>
                                                            <button className="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200">
                                                                Track
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>

                    <ItemModal
                        isOpen={showAddModal}
                        onClose={() => {
                            setShowAddModal(false);
                            setEditingItem(null);
                        }}
                        onSave={handleSaveItem}
                        item={editingItem}
                        locations={locations}
                    />
                </div>
            );
        };

        // Transfers & Bins Tab
        const TransfersTab = ({ transfers, setTransfers, locations, inventoryData, spService, isLoading, refreshData }) => {
            const [showTransferModal, setShowTransferModal] = useState(false);
            const [isCreating, setIsCreating] = useState(false);
            
            const handleCreateTransfer = async (transferData) => {
                setIsCreating(true);
                try {
                    await spService.createTransfer(transferData);
                    alert('✅ Transfer request created successfully!');
                    await refreshData();
                    setShowTransferModal(false);
                } catch (error) {
                    alert('❌ Error creating transfer: ' + error.message);
                }
                setIsCreating(false);
            };
            
            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-2xl font-bold">🔄 Transfers & Bin Management</h2>
                            <p className="text-gray-600">Manage warehouse transfers via SharePoint</p>
                        </div>
                        <div className="flex gap-3">
                            <button
                                onClick={refreshData}
                                className="px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 flex items-center gap-2"
                            >
                                {isLoading ? <div className="loading-spinner" /> : '🔄'} Refresh
                            </button>
                            <button
                                onClick={() => setShowTransferModal(true)}
                                className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                Create Transfer
                            </button>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-3 gap-6">
                        <div className="dashboard-card">
                            <h3 className="font-bold mb-3">📍 Location Utilization</h3>
                            <div className="space-y-2 text-sm">
                                {locations.slice(0, 5).map(loc => (
                                    <div key={loc.id} className="flex justify-between">
                                        <span>{loc.name}</span>
                                        <span className="font-bold">{loc.utilization || Math.floor(Math.random() * 50 + 40)}%</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="dashboard-card">
                            <h3 className="font-bold mb-3">🚚 Transfer Summary</h3>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between">
                                    <span>Total Transfers</span>
                                    <span className="font-bold">{transfers.length}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Pending</span>
                                    <span className="font-bold text-yellow-600">{transfers.filter(t => t.status === 'Pending').length}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>In Transit</span>
                                    <span className="font-bold text-blue-600">{transfers.filter(t => t.status === 'In Transit').length}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Completed</span>
                                    <span className="font-bold text-green-600">{transfers.filter(t => t.status === 'Completed').length}</span>
                                </div>
                            </div>
                        </div>

                        <div className="dashboard-card">
                            <h3 className="font-bold mb-3">🎯 SharePoint Status</h3>
                            <div className="space-y-2 text-sm">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span>Transfer List Connected</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span>Workflow Automation Active</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span>Power Automate Linked</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div className="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h3 className="text-lg font-semibold">Transfer History from SharePoint</h3>
                        </div>
                        <div className="p-6">
                            {isLoading ? (
                                <div className="text-center py-8">
                                    <div className="loading-spinner mx-auto mb-4" style={{width: '40px', height: '40px'}} />
                                    <p>Loading transfer data from SharePoint...</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {transfers.map(transfer => (
                                        <div key={transfer.id} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <div className="font-semibold">{transfer.itemName}</div>
                                                    <div className="text-sm text-gray-600">
                                                        {transfer.fromLocation} → {transfer.toLocation}
                                                    </div>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        Quantity: {transfer.quantity} | Priority: {transfer.priority} | Created: {transfer.createdDate}
                                                    </div>
                                                    {transfer.notes && (
                                                        <div className="text-xs text-gray-600 mt-2">
                                                            Notes: {transfer.notes}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="text-right">
                                                    <span className={`status-badge ${
                                                        transfer.status === 'Completed' ? 'bg-green-100 text-green-800' :
                                                        transfer.status === 'In Transit' ? 'bg-blue-100 text-blue-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }`}>
                                                        {transfer.status}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    <TransferModal
                        isOpen={showTransferModal}
                        onClose={() => setShowTransferModal(false)}
                        onSave={handleCreateTransfer}
                        inventoryData={inventoryData}
                        locations={locations}
                    />
                </div>
            );
        };

        // Reports Tab
        const ReportsTab = ({ inventoryData, locations, transfers, isLoading }) => {
            const calculateMetrics = () => {
                const totalValue = inventoryData.reduce((sum, item) => sum + (item.quantity * item.unitCost), 0);
                const lowStockCount = inventoryData.filter(item => item.quantity <= item.minQuantity).length;
                const inventoryAccuracy = inventoryData.length > 0 ? ((inventoryData.length - lowStockCount) / inventoryData.length * 100).toFixed(1) : 0;
                const criticalItemsCount = inventoryData.filter(item => item.criticality === 'High').length;
                
                return { totalValue, lowStockCount, inventoryAccuracy, criticalItemsCount };
            };

            const metrics = calculateMetrics();

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-2xl font-bold">📊 Analytics & Insights</h2>
                        <p className="text-gray-600">Real-time SharePoint data analytics</p>
                    </div>

                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="dashboard-card">
                            <h3 className="text-lg font-bold mb-4">💰 Inventory Metrics</h3>
                            <div className="space-y-4">
                                <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <div>
                                        <div className="font-medium">Total Inventory Value</div>
                                        <div className="text-sm text-gray-600">Across all locations</div>
                                    </div>
                                    <div className="text-xl font-bold text-green-600">
                                        {isLoading ? <div className="loading-spinner" /> : `${metrics.totalValue.toLocaleString()}`}
                                    </div>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                    <div>
                                        <div className="font-medium">Total SKUs</div>
                                        <div className="text-sm text-gray-600">Unique items tracked</div>
                                    </div>
                                    <div className="text-xl font-bold text-blue-600">{inventoryData.length}</div>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                    <div>
                                        <div className="font-medium">Critical Items</div>
                                        <div className="text-sm text-gray-600">High criticality</div>
                                    </div>
                                    <div className="text-xl font-bold text-purple-600">{metrics.criticalItemsCount}</div>
                                </div>
                            </div>
                        </div>

                        <div className="dashboard-card">
                            <h3 className="text-lg font-bold mb-4">📈 Performance Metrics</h3>
                            <div className="space-y-3">
                                <div>
                                    <div className="flex justify-between mb-1">
                                        <span className="text-sm">Inventory Accuracy</span>
                                        <span className="text-sm font-bold">{metrics.inventoryAccuracy}%</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div className="bg-green-600 h-2 rounded-full" style={{width: `${metrics.inventoryAccuracy}%`}}></div>
                                    </div>
                                </div>
                                <div>
                                    <div className="flex justify-between mb-1">
                                        <span className="text-sm">Location Utilization</span>
                                        <span className="text-sm font-bold">76.4%</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div className="bg-blue-600 h-2 rounded-full" style={{width: '76.4%'}}></div>
                                    </div>
                                </div>
                                <div>
                                    <div className="flex justify-between mb-1">
                                        <span className="text-sm">SharePoint Sync Health</span>
                                        <span className="text-sm font-bold">100%</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div className="bg-purple-600 h-2 rounded-full" style={{width: '100%'}}></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h3 className="text-lg font-bold mb-4">📊 Location-wise Inventory Distribution</h3>
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {locations.map(location => {
                                const locationItems = inventoryData.filter(item => item.location === location.name);
                                const locationValue = locationItems.reduce((sum, item) => sum + (item.quantity * item.unitCost), 0);
                                
                                return (
                                    <div key={location.id} className="p-4 border border-gray-200 rounded-lg">
                                        <div className="font-medium">{location.name}</div>
                                        <div className="text-sm text-gray-600 mt-1">
                                            Items: {locationItems.length} | Value: ${locationValue.toLocaleString()}
                                        </div>
                                        <div className="text-xs text-gray-500 mt-2">
                                            Type: {location.type}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h3 className="text-lg font-bold mb-4">🎯 Export & Reporting Options</h3>
                        <div className="grid md:grid-cols-3 gap-4">
                            <button className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left">
                                <div className="font-medium">📈 Inventory Valuation Report</div>
                                <div className="text-sm text-gray-600 mt-1">Export to Excel via SharePoint</div>
                            </button>
                            <button className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left">
                                <div className="font-medium">📊 Stock Movement Analysis</div>
                                <div className="text-sm text-gray-600 mt-1">Power BI dashboard link</div>
                            </button>
                            <button className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 text-left">
                                <div className="font-medium">📋 Compliance Report</div>
                                <div className="text-sm text-gray-600 mt-1">Generate via Power Automate</div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Integrations Tab
        const IntegrationsTab = ({ siteUrl, isConnected }) => {
            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-2xl font-bold">🔗 Enterprise Integrations</h2>
                        <p className="text-gray-600">SharePoint and enterprise system connections</p>
                    </div>

                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
                            <div className="flex items-center space-x-3 mb-4">
                                <SharePointIcon />
                                <h3 className="text-xl font-bold">SharePoint Integration</h3>
                                {isConnected && (
                                    <span className="status-badge bg-green-100 text-green-800">Connected</span>
                                )}
                            </div>
                            <div className="space-y-3 text-sm">
                                <div className="flex justify-between">
                                    <span>Connection Status</span>
                                    <span className={`font-medium ${isConnected ? 'text-green-600' : 'text-red-600'}`}>
                                        {isConnected ? 'Active' : 'Not Connected'}
                                    </span>
                                </div>
                                {siteUrl && (
                                    <div className="flex justify-between">
                                        <span>Site URL</span>
                                        <span className="text-xs text-gray-600 truncate max-w-xs">{siteUrl}</span>
                                    </div>
                                )}
                                <div className="flex justify-between">
                                    <span>Lists Connected</span>
                                    <span>4 Lists</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>API Version</span>
                                    <span>REST API v1</span>
                                </div>
                            </div>
                            <div className="mt-4 pt-4 border-t border-gray-200">
                                <h4 className="font-medium mb-2">Connected Lists</h4>
                                <ul className="text-sm space-y-1 text-gray-600">
                                    <li>✓ SKA_Inventory_Master</li>
                                    <li>✓ SKA_Locations</li>
                                    <li>✓ SKA_Transfers2</li>
                                    <li>✓ SKA_Work_Orders1</li>
                                </ul>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
                            <div className="flex items-center space-x-3 mb-4">
                                <LimbleIcon />
                                <h3 className="text-xl font-bold">Limble CMMS</h3>
                                <span className="status-badge bg-yellow-100 text-yellow-800">Ready</span>
                            </div>
                            <div className="space-y-3 text-sm">
                                <div className="flex justify-between">
                                    <span>Integration Status</span>
                                    <span className="text-yellow-600 font-medium">Ready to Configure</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Work Orders</span>
                                    <span>Via Power Automate</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Asset Management</span>
                                    <span className="text-blue-600 font-medium">Available</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Maintenance Scheduling</span>
                                    <span className="text-blue-600 font-medium">Available</span>
                                </div>
                            </div>
                            <div className="mt-4 pt-4 border-t border-gray-200">
                                <h4 className="font-medium mb-2">Power Automate Flows</h4>
                                <ul className="text-sm space-y-1 text-gray-600">
                                    <li>• Low stock → Create work order</li>
                                    <li>• Scheduled maintenance alerts</li>
                                    <li>• Asset tracking updates</li>
                                    <li>• Automated reorder requests</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h3 className="text-lg font-bold mb-4">🔧 Power Automate Configuration</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 className="font-medium mb-3">Active Flows</h4>
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <div>
                                            <div className="font-medium">Low Stock Alert Flow</div>
                                            <div className="text-xs text-gray-600">Runs daily at 8:00 AM</div>
                                        </div>
                                        <span className="text-green-600">Active</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <div>
                                            <div className="font-medium">Transfer Approval Workflow</div>
                                            <div className="text-xs text-gray-600">Triggered on item creation</div>
                                        </div>
                                        <span className="text-green-600">Active</span>
                                    </div>
                                    <div className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                        <div>
                                            <div className="font-medium">Limble Work Order Sync</div>
                                            <div className="text-xs text-gray-600">Requires configuration</div>
                                        </div>
                                        <span className="text-yellow-600">Setup Required</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 className="font-medium mb-3">Integration Health</h4>
                                <div className="space-y-3">
                                    <div className="p-3 bg-gray-50 rounded-lg">
                                        <div className="flex justify-between mb-2">
                                            <span className="text-sm">SharePoint API Calls (24h)</span>
                                            <span className="font-medium">1,247</span>
                                        </div>
                                        <div className="flex justify-between mb-2">
                                            <span className="text-sm">Average Response Time</span>
                                            <span className="font-medium text-green-600">145ms</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-sm">Error Rate</span>
                                            <span className="font-medium text-green-600">0.02%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const EnterpriseInventoryApp = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [inventoryData, setInventoryData] = useState([]);
            const [locations, setLocations] = useState([]);
            const [transfers, setTransfers] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [isConfigured, setIsConfigured] = useState(false);
            const [siteUrl, setSiteUrl] = useState('');
            const [spService, setSpService] = useState(null);

            const configureSiteUrl = (url) => {
                setSiteUrl(url);
                const service = new SharePointService(url);
                setSpService(service);
                setIsConfigured(true);
                loadData(service);
            };

            const loadData = async (service = spService) => {
                if (!service) return;
                
                setIsLoading(true);
                try {
                    const [inventoryItems, locationsList, transfersList] = await Promise.all([
                        service.getInventoryItems(),
                        service.getLocations(),
                        service.getTransfers()
                    ]);
                    
                    setInventoryData(inventoryItems);
                    setLocations(locationsList);
                    setTransfers(transfersList);
                } catch (error) {
                    console.error('Error loading data:', error);
                    // Fallback to sample data if SharePoint fails
                    alert('⚠️ Could not connect to SharePoint. Loading sample data instead.');
                    loadSampleData();
                }
                setIsLoading(false);
            };

            const loadSampleData = () => {
                const sampleLocations = [
                    { id: 'cpf-core', name: 'CPF Core Facility', type: 'CPF (Central Processing Facility)', address: 'Central Processing Facility - Core Area' },
                    { id: 'cpf-warehouse', name: 'CPF Main Warehouse', type: 'CPF (Central Processing Facility)', address: 'Main Distribution Hub - Murchison' },
                    { id: 'rpf-s8', name: 'RPF S8 Station', type: 'RPF (Remote Processing Facility)', address: 'Southern Arm - FS345-350 Cluster' },
                    { id: 'rpf-n8', name: 'RPF N8 Station', type: 'RPF (Remote Processing Facility)', address: 'Northern Arm - FS375-378 Cluster' },
                    { id: 'rpf-e8', name: 'RPF E8 Station', type: 'RPF (Remote Processing Facility)', address: 'Eastern Arm - FS315-318 Cluster' }
                ];

                const sampleInventory = [
                    { id: 1, name: 'LFAA Tile Array', partNumber: 'LFAA-TILE-256', serialNumber: 'SN001234', batchNumber: 'B2025001', location: 'CPF Core Facility', quantity: 25, minQuantity: 10, category: 'Telescope Hardware', vendor: 'LFAA Systems', unitCost: 2500, criticality: 'High', lastUpdated: '2025-06-25', binLocation: 'A-1-01' },
                    { id: 2, name: 'Signal Processing Unit', partNumber: 'SPU-MARK4-001', serialNumber: 'SN005678', batchNumber: 'B2025002', location: 'CPF Main Warehouse', quantity: 15, minQuantity: 5, category: 'Electronics', vendor: 'Digital Systems Corp', unitCost: 1800, criticality: 'High', lastUpdated: '2025-06-24', binLocation: 'B-2-03' },
                    { id: 3, name: 'Power Distribution Unit', partNumber: 'PDU-48V-20A', serialNumber: 'SN009012', batchNumber: 'B2025003', location: 'RPF S8 Station', quantity: 8, minQuantity: 3, category: 'Power Systems', vendor: 'Power Systems Inc', unitCost: 450, criticality: 'High', lastUpdated: '2025-06-25', binLocation: 'C-1-02' },
                    { id: 4, name: 'Optical Fiber Cable', partNumber: 'OFC-12C-SM-1KM', serialNumber: 'SN003456', batchNumber: 'B2025004', location: 'RPF N8 Station', quantity: 2, minQuantity: 5, category: 'Cables & Connectivity', vendor: 'Fiber Optics Ltd', unitCost: 120, criticality: 'Medium', lastUpdated: '2025-06-26', binLocation: 'D-3-01' }
                ];

                const sampleTransfers = [
                    { id: 1, itemName: 'Signal Processing Unit', fromLocation: 'CPF Core Facility', toLocation: 'RPF S8 Station', quantity: 2, status: 'In Transit', createdDate: '2025-06-25', priority: 'High' },
                    { id: 2, itemName: 'LFAA Tile Array', fromLocation: 'CPF Main Warehouse', toLocation: 'RPF N8 Station', quantity: 5, status: 'Pending', createdDate: '2025-06-24', priority: 'Normal' },
                    { id: 3, itemName: 'Power Distribution Unit', fromLocation: 'RPF E8 Station', toLocation: 'CPF Core Facility', quantity: 1, status: 'Completed', createdDate: '2025-06-23', priority: 'Low' }
                ];

                setLocations(sampleLocations);
                setInventoryData(sampleInventory);
                setTransfers(sampleTransfers);
            };

            const refreshData = () => {
                if (spService) {
                    loadData();
                }
            };

            const renderActiveTab = () => {
                switch (activeTab) {
                    case 'dashboard':
                        return <DashboardTab 
                            inventoryData={inventoryData} 
                            locations={locations} 
                            transfers={transfers} 
                            isLoading={isLoading}
                        />;
                    case 'inventory':
                        return <InventoryTab 
                            inventoryData={inventoryData} 
                            setInventoryData={setInventoryData} 
                            locations={locations} 
                            spService={spService}
                            isLoading={isLoading}
                            refreshData={refreshData}
                        />;
                    case 'transfers':
                        return <TransfersTab 
                            transfers={transfers} 
                            setTransfers={setTransfers} 
                            locations={locations} 
                            inventoryData={inventoryData}
                            spService={spService}
                            isLoading={isLoading}
                            refreshData={refreshData}
                        />;
                    case 'reports':
                        return <ReportsTab 
                            inventoryData={inventoryData} 
                            locations={locations} 
                            transfers={transfers}
                            isLoading={isLoading}
                        />;
                    case 'integrations':
                        return <IntegrationsTab 
                            siteUrl={siteUrl}
                            isConnected={isConfigured}
                        />;
                    default:
                        return <DashboardTab 
                            inventoryData={inventoryData} 
                            locations={locations} 
                            transfers={transfers}
                            isLoading={isLoading}
                        />;
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    <Sidebar 
                        activeTab={activeTab} 
                        setActiveTab={setActiveTab} 
                        isOpen={sidebarOpen} 
                        setIsOpen={setSidebarOpen} 
                    />
                    
                    <div className="main-content">
                        <div className="mb-6 lg:hidden">
                            <button
                                onClick={() => setSidebarOpen(true)}
                                className="px-4 py-2 bg-gray-800 text-white rounded-lg"
                            >
                                ☰ Menu
                            </button>
                        </div>
                        
                        <ConfigurationPanel 
                            isConfigured={isConfigured}
                            onConfigure={configureSiteUrl}
                        />
                        
                        {isConfigured && renderActiveTab()}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<EnterpriseInventoryApp />, document.getElementById('root'));
    </script>
</body>
</html>
